---
title: "Reproducible Research Assignment 1"
output:
    html_document:
        keep_md: yes
---
Dataset used for this analysis can be [downloaded](https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2Factivity.zip) from the website of Coursera's course Reproducible Research. It consists of 17568 observations and 3 variables. All observations are number of steps of one single individual recorded in 5-minute intervals throughout the whole 24 hours. Steps were recorded during the months of October and November.   

##Loading and preprocessing the data    
```{r}
library(knitr)
opts_chunk$set(echo = TRUE,  message = FALSE, cache = TRUE, cache.path = "cache/", fig.path = "figure/")   


Sys.setlocale("LC_ALL", "C")
unzip("activity.zip", files = NULL, list = FALSE, overwrite = TRUE, junkpaths = FALSE, exdir = ".", unzip = "internal", setTimes = FALSE)
activity <- read.csv("activity.csv", stringsAsFactors = FALSE)

str(activity)
activity.cleaned <- activity
```
The dataset contains 3 variables: steps, date and interval. We can turn variable **date** into a variable of date format. The **interval** variable contains 5 minute intervals, so to turn it properly into date and time format it is important to notice that interval 55 is followed by 100, marking a full hour(1:00) and not 100 minutes, as one might falsly conclude. If we take that as 100 minutes we would have a gap of 40 minutes which isn't the case: the intervals were noted consecutively and if a measurement lacked data this was noted as NA in the variable **steps**.   
```{r}
split.intervals <- as.character(activity.cleaned$interval)
split.intervals <- strsplit(split.intervals, "")
#this function should put intervals into propper hh:mm format, so to avoid a gap of 40 minutes that would occur if we let 100 be read as 100 minutes instead of 01:00 hour which is correct way:
set.time <- function(split.intervals){
  container <- vector(length = length(split.intervals))
  ##function that takes intervals and turns them into hh:mm format
  for (i in 1:length(split.intervals)){
    if (length(split.intervals[[i]]) == 1){
      x = paste("00:0", split.intervals[[i]], sep = "")
    }
      
    if (length(split.intervals[[i]]) == 2){
      x = paste("00", paste(split.intervals[[i]][1], split.intervals[[i]][2], sep = ""), sep = ":")
    }
    
    if (length(split.intervals[[i]]) == 3){
      x = paste("0", paste(split.intervals[[i]][1], paste(split.intervals[[i]][2], split.intervals[[i]][3], sep = ""), sep = ":"), sep = "")
    } 
    
    if (length(split.intervals[[i]]) == 4){
      x = paste(paste(split.intervals[[i]][1], split.intervals[[i]][2], sep = ""),
                paste(split.intervals[[i]][3], split.intervals[[i]][4], sep = ""),
                sep = ":")
    }
    container[i] <- x
  }
  container
}
time <- set.time(split.intervals)
datetime <- paste(activity.cleaned$date, time, sep = " ")

```


The original dataset is preserved as is, and changes are contained in the dataset named `activity.cleaned`
```{r}
library(lubridate)

activity.cleaned$date <- ymd(activity.cleaned$date)
str(activity.cleaned$date)
activity.cleaned$date.min <-ymd_hm(datetime) 
activity.cleaned$time <- time

head(activity.cleaned)
str(activity.cleaned)
```
     
     
##What is mean total number of steps taken per day?   
To find out total number of steps taken per day first we need to sum all the steps measured at intervals within a day, and then calculate the mean and median of total number of steps across all the days that we have data for:
```{r}
#summing all the steps within each day
(total.steps <- with(activity.cleaned, tapply(steps, date, sum)))
str(total.steps)
(mean.total.steps <- mean(total.steps, na.rm = TRUE))
(median.total.steps <- median(total.steps,na.rm = TRUE))
```
I have decided to not remove NA observations when calculating sum, hence the days where there are missing observations will have NA as a number of total steps taken that day. In case I have decided to remove NA's when calculating sum I would have 0 steps for days with missing observation. That would mean that we accepted that participant made 0 steps that particular day with missing observation day which is not realistic. However, when calculating mean and median of to avoid having NA as mean and median NA's have to be removed by adding `na.rm = TRUE` argument to the function.    
The mean number of steps per day is `r sprintf("%.2f", mean.total.steps)`, while median number of steps per day is `r median.total.steps`.
```{r}
library(ggplot2)
h <- qplot(total.steps, binwidth = 3000, main = "Histogram of total number of steps \n taken each day", xlab = "Total steps a day")
h + geom_vline(xintercept = mean.total.steps, color = "red")

summary(total.steps)

```    

##What is the average daily activity pattern?  
To make a time series plot of the 5-minute intervals and average number of steps per interval across all days in the dataset, we need to first calculate average number of steps per interval across all days:
```{r}
ts <- with(activity.cleaned, tapply(steps, time, mean, na.rm = TRUE))
head(ts,30)

intervals1 <- names(ts)
tsch <- ts  #we'll need this later

(indmax <- which.max(ts)) #index of observation
(ts[indmax])  #value of actual maximal observation
```
The maximum number of steps are found in the interval that matches 8:35 am and is approximately 206 steps.   
```{r}
df.mean.intervals <- data.frame(means = as.numeric(as.character(ts)), intervals1 = intervals1)
ggplot(data = df.mean.intervals, aes(x = seq_along(intervals1), y = means))  +
    geom_line(color = "red") +
    labs(x = "Time of day", y = "Steps", title = "Average Activity \n Throughout the Day")  +
    geom_vline(xintercept = seq_along(intervals1)[104], color = "green")  +
    scale_x_continuous(breaks = c(1,50, 104, 150, 200, 250, 288), label = intervals1[c(1,50, 104, 150, 200, 250, 288)])

```     

From the plot of daily activity we can see that activity is very low during first about five hours and late in the evening, few hours before midnight. This is expected because people usually sleep during that time. The peak happens at 8:35, with 206 steps on average. This is usually the time when people hurry to get to work: the frequency of steps per interval increases.       

##Imputing missing values    
There are 2304 missing values in this dataset. 
```{r}
#number of missing values in dataset:
(numberNA <- sum(is.na(activity.cleaned$steps)))

#imputing mean values:
indx.na <- which(is.na(activity.cleaned$steps))
zzz <- activity.cleaned$steps
zzz[indx.na] <- ts[paste(activity.cleaned$time[indx.na], "", sep = "")]
head(zzz, 10)
head(tsch, 10)

#adding column with imputed steps to the dataset ( missing value filled)

activity.cleaned$imputed.steps <- zzz 

#calculating mean number of steps per interval with imputed  data
(total.steps.imp <- with(activity.cleaned, tapply(imputed.steps, date, sum)))

qplot(total.steps.imp, binwidth = 3000, main = "Histogram of Total Steps \n Taken Each Day \n (missing values imputed)", xlab = "Total steps per day \n (missing values imputed)")   +
  geom_vline(xintercept = mean(total.steps.imp), color = "red")

(mean.total.steps.imp <- mean(total.steps.imp))
mean.total.steps.imp != mean.total.steps
(median.total.steps.imp <- median(total.steps.imp))
```   

When we impute mean number of steps per interval in places with missing values the mean number of steps per day(`r sprintf("%.2f", mean.total.steps.imp)`) is the same as the mean number of steps calculated by ignoring mising data (`r sprintf("%.2f", mean.total.steps)`). The median with missing data(`r median.total.steps`) is slightly smaller than the median with imputed data(`r sprintf("%.2f", median.total.steps.imp)`).      
  
##Are there differences in activity patterns between weekdays and weekends?   
It might be reasonable to expect that daily activity pattern differs between weekdays and weekends. To explore that, we might draw a plot that shows daily activity pattern separately for wekdays and weekends.
```{r}
y <- weekdays(activity.cleaned$date)
activity.cleaned$day <- ifelse(y == c("Saturday", "Sunday"), "Weekend", "Weekday")
head(activity.cleaned$day)

ts.weekday <- with(activity.cleaned[activity.cleaned$day == "Weekday", ], tapply(imputed.steps, time, mean))
ts.weekend <- with(activity.cleaned[activity.cleaned$day == "Weekend", ], tapply(imputed.steps, time, mean))
df <- data.frame(mean.val = ts.weekday,  time = names(ts.weekday), day = "Weekday", dt = activity.cleaned$date.min[1:288])
head(df)            
df2 <- data.frame(mean.val = ts.weekend, time = names(ts.weekday), day = "Weekend", dt = activity.cleaned$date.min[1:288])
head(df2)
df.mean <- rbind(df, df2)
dim(df.mean)
names(df.mean)
df.mean$mean.val <- as.numeric(as.character(df.mean$mean.val))

ggplot(data = df.mean, aes(x = df.mean$dt, y = mean.val))  +
  geom_line(color = "red") +
  labs(y = "Steps", x = "Time of day")  +
  facet_grid(day ~ .)  +
  scale_x_datetime(breaks = df.mean$dt[c(1,50, 100, 150, 200, 250, 288)],labels = time[c(1,50,100,150,200,250,288)])
      
```    

I would describe the difference between these two plots as following: On weekdays people usually get up earlier than on weekdays, but the peak is about the same time. However, important difference is that during the rest of the day our observed individual walks more on weekends than on weekdays. Could it be because the participant has job that is mostly sedentary, and on weekends perhaps tries to be more physically active, runs errands, spends time with kids doing some physical activity?      
