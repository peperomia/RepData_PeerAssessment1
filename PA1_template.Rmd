---
title: "Reproducible Research Assignment 1"
output: html_document
---
Dataset used for this analysis can be [downloaded](https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2Factivity.zip) from the website of Coursera's course Reproducible Research.    

##Loading and preprocessing the data    
```{r}
setwd("C:/Users/Karmen/Documents")
Sys.setlocale("LC_ALL", "C")
activity <- read.csv("C:/Users/Karmen/Desktop/All Things Coursera/current/DATA SCIENCE Johns Hopkins/Reproducible Research/Assignment 1/activity.csv")

str(activity)
```
The dataset contains 3 variables: steps, date and interval. We can turn variable **date** into a variable of date format. The **interval** variable contains 5 minute intervals, so to turn it properly into date and time format it is important to notice that interval 55 is followed by 100, marking a full hour(1:00) and not 100 minutes, as one might falsly conclude. If we take that as 100 minutes we would have a gap of 40 minutes which isn't the case: the intervals were noted consecutively and if a measurement lacked data this was noted as NA in the variable **steps**.   
The original dataset is preserved as is, and changes are contained in the dataset named `activity.cleaned`
```{r}
library(lubridate)
activity.cleaned <- activity
activity.cleaned$date <- ymd(activity.cleaned$date)
str(activity.cleaned$date)
activity.cleaned$date.min <-activity.cleaned$date  
minute(activity.cleaned$date.min) <- activity.cleaned$interval
head(activity.cleaned)
str(activity.cleaned)

```

##What is mean total number of steps taken per day?   
To find out that first find total number of steps taken each day, and then calculate the mean of total number of steps across all the days that we have data for:
```{r}

(total.steps <- with(activity.cleaned, tapply(steps, date, sum, na.rm= TRUE)))
str(total.steps)
(mean.total.steps <- mean(total.steps))
(median.total.steps <- median(total.steps))
```
The mean number of steps per day is `r sprintf("%.2f", mean.total.steps)`, while median number of steps per day is `r median.total.steps`.
```{r}
library(ggplot2)
h <- qplot(total.steps, binwidth = 3000, main = "Histogram of total number of steps \n taken each day", xlab = "Total steps a day")
h + geom_vline(xintercept = mean.total.steps, color = "red")


summary(total.steps)

```   
##What is the average daily activity pattern?  
To make a time series plot of the 5-minute intervals and average number of steps per interval across all days in the dataset, we need to first calculate average number of steps per interval across all days:
```{r}
ts <- with(activity.cleaned, tapply(steps, interval, mean, na.rm = TRUE))
head(ts,30)

intervals1 <- names(ts)
intervals2 <- sprintf("%04d", as.numeric(intervals1))
intervals3 <- strptime(intervals2, format = "%H%M")      #puts time in correct hour and minute format, but it assigns it a date which is a date  at the moment of processing this code.
tsch <- ts  #we'll need this later
names(ts) <- intervals3
(indmax <- which.max(ts)) #index of observation
(ts[indmax])  #value of actual maximal observation
```
The maximum number of steps are found in the interval that matches 8:35 am and is approximately 206 steps.   
```{r}
plot(x = intervals3, y = as.numeric(ts), col = "red", type = "l", ylab = "Steps", xlab = "Time of day", main = "Average Activity \n Throughout the Day")
abline(v = as.numeric(intervals3[indmax]), col = "green")
```     

From the plot of daily activity we can see that activity is very low during first about five hours and late in the evening, few hours before midnight. This is expected because people usually sleep during that time. The peak happens at 8:35, with 206 steps on average. This can be explained by people hurrying to get to work: the frequency of steps per interval increases.      
##Imputing missing values    
There are 2304 missing values in this dataset. 
```{r}
#number of missing values in dataset:
(numberNA <- sum(is.na(activity.cleaned$steps)))

#imputing mean values:
indx.na <- which(is.na(activity.cleaned$steps))
zzz <- activity.cleaned$steps
zzz[indx.na] <- tsch[paste(activity.cleaned$interval[indx.na], "", sep = "")]
head(zzz, 10)
head(tsch, 10)
head(activity.cleaned)

#adding column with imputed steps to the dataset ( missing value filled)

activity.cleaned$imputed.steps <- zzz
(total.steps.imp <- with(activity.cleaned, tapply(imputed.steps, date, sum)))

qplot(total.steps.imp, binwidth = 3000, main = "Histogram of Total Steps \n Taken Each Day \n (missing values imputed)", xlab = "Total steps per day \n (missing values imputed)")   +
  geom_vline(xintercept = mean(total.steps.imp), color = "red")

(mean.total.steps.imp <- mean(total.steps.imp))
mean.total.steps.imp > mean.total.steps
(median.total.steps.imp <- median(total.steps.imp))
```   

When we impute mean number of steps per interval in places with missing values the mean number of steps per day(`r sprintf("%.2f", mean.total.steps.imp)`) is bigger than without imputed data(`r sprintf("%.2f", mean.total.steps)`). The median with imputed data is exactly the same as the mean with imputed data, which is greater than the median with missing values(`r median.total.steps`).    
```{r}
split.intervals <- as.character(activity.cleaned$interval)
split.intervals <- strsplit(split.intervals, "")
set.time <- function(split.intervals){
  container <- vector(length = length(split.intervals))
  for (i in 1:length(split.intervals)){
    if (length(split.intervals[[i]]) == 1){
      x = paste("00:0", split.intervals[[i]], sep = "")
    }
      
    if (length(split.intervals[[i]]) == 2){
      x = paste("00", paste(split.intervals[[i]][1], split.intervals[[i]][2], sep = ""), sep = ":")
    }
    
    if (length(split.intervals[[i]]) == 3){
      x = paste("0", paste(split.intervals[[i]][1], paste(split.intervals[[i]][2], split.intervals[[i]][3], sep = ""), sep = ":"), sep = "")
    } 
    
    if (length(split.intervals[[i]]) == 4){
      x = paste(paste(split.intervals[[i]][1], split.intervals[[i]][2], sep = ""),
                paste(split.intervals[[i]][3], split.intervals[[i]][4], sep = ""),
                sep = ":")
    }
    container[i] <- x
  }
  container
}
time <- set.time(split.intervals)
datetime <- paste(activity.cleaned$date, time, sep = " ")

```

##Are there differences in activity patterns between weekdays and weekends?   
It might be reasonable to expect that daily activity pattern differs between weekdays and weekends. To explore that, we might draw a plot that shows daily activity pattern separately for wekdays and weekends.
```{r}
y <- weekdays(activity.cleaned$date)
activity.cleaned$day <- ifelse(y == c("Saturday", "Sunday"), "Weekend", "Weekday")
head(activity.cleaned$day)

ts.weekday <- with(activity.cleaned[activity.cleaned$day == "Weekday", ], tapply(imputed.steps, interval, mean))
ts.weekend <- with(activity.cleaned[activity.cleaned$day == "Weekend", ], tapply(imputed.steps, interval, mean))
df <- data.frame(mean.val = ts.weekday,  interval = names(ts.weekday), day = "Weekday", dt = activity.cleaned$date.min[1:288])
head(df)            
df2 <- data.frame(mean.val = ts.weekend, interval = names(ts.weekday), day = "Weekend", dt = activity.cleaned$date.min[1:288])
head(df2)
df.mean <- rbind(df, df2)
dim(df.mean)
names(df.mean)
df.mean$mean.val <- as.numeric(as.character(df.mean$mean.val))
df.mean$interval <- as.numeric(as.character(df.mean$interval))
df.mean$intervalx <- append(activity.cleaned$date.min[1:288], activity.cleaned$date.min[1:288])
ggplot(data = df.mean, aes(x = df.mean$dt, y = mean.val))  +
  geom_line(color = "red") +
  labs(y = "Steps", x = "Time of day")  +
  facet_grid(day ~ .)  +
  scale_x_datetime(breaks = df.mean$dt[c(1,50, 100, 150, 200, 250, 288)],labels = time[c(1,50,100,150,200,250,288)])
      
```    

I would describe the difference between these two plots as following: On weekdays people get up earlier than on weekdays, but the peak is about the same time. However, important differrence is that during the rest of the day people walk more on weekends than on weekdays. Could it be because people have mostly sedentary jobs, and on weekends try to be more physically active, run errands, spend time with kids doing some physical activity? That would be some of the explantions.    
